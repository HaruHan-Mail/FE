# HTTP (port 80) 서버 블록: 모든 요청을 HTTPS로 리디렉션합니다.
server {
    listen 80;
    server_name haruhan.site; # 여기에 도메인 이름을 명시합니다.
    return 301 https://$server_name$request_uri;
}

# HTTPS (port 443) 서버 블록: 실제 앱 로직을 처리합니다.
server {
    listen 443 ssl;
    server_name haruhan.site; # 여기에 도메인 이름을 명시합니다.

    # --- SSL 인증서 경로 (매우 중요) ---
    # 아래 경로는 실제 서버의 인증서 위치에 맞게 수정해야 할 수 있습니다.
    # 일반적으로 Let's Encrypt를 사용하면 아래와 비슷한 경로에 위치합니다.
    ssl_certificate /etc/letsencrypt/live/haruhan.site/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/haruhan.site/privkey.pem;

    # 모든 요청에 대해 /usr/share/nginx/html 디렉토리에서 파일을 찾습니다.
    root /usr/share/nginx/html;
    index index.html;

    # Gzip 압축 활성화
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss;

    # SPA(Single Page Application)를 위한 설정
    location / {
        try_files $uri $uri/ /index.html;
        # index.html은 캐시하지 않도록 설정
        add_header Cache-Control 'no-cache, no-store, must-revalidate';
    }

    # 이름에 해시가 포함된 정적 파일들에 대한 캐시 정책
    location ~* \.(?:css|js|jpg|jpeg|gif|png|ico|webp|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
} 